name: Auto Label PRs

on:
  pull_request:
    types: [ opened, edited, synchronize ]

permissions:
  contents: read
  pull-requests: write

jobs:
  auto-label:
    runs-on: ubuntu-latest

    steps:
      - name: Determine label based on PR title prefix
        id: detect
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          TITLE="$PR_TITLE"

          echo "ðŸ” Original Title: $TITLE"

          # ëŒ€ì†Œë¬¸ìž í†µì¼
          TITLE=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]')
          echo "ðŸ” Normalized Title: $TITLE"

          # ê¸°ë³¸ ë¼ë²¨
          LABEL="chore"

          case "$TITLE" in
            feat:* | "[feat]"*) LABEL="feature" ;;
            fix:* | "[fix]"*) LABEL="fix" ;;
            hotfix:* | "[hotfix]"*) LABEL="hotfix" ;;
            chore:* | "[chore]"*) LABEL="chore" ;;
            refactor:* | "[refactor]"*) LABEL="refactor" ;;
            test:* | "[test]"*) LABEL="test" ;;
            docs:* | "[docs]"*) LABEL="docs" ;;
            design:* | "[design]"*) LABEL="design" ;;
          esac

          echo "ðŸŽ¯ Label to apply: $LABEL"
          echo "label=$LABEL" >> "$GITHUB_OUTPUT"

      - name: Apply the detected label
        uses: actions-ecosystem/action-add-labels@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: ${{ steps.detect.outputs.label }}
